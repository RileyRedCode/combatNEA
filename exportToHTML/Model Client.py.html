<html>
<head>
<title>Model Client.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #f97bb0; font-weight: bold;}
.s1 { color: #dfdfe0;}
.s2 { color: #ff806c;}
.s3 { color: #d7c781;}
.s4 { color: #7f8c99;}
</style>
</head>
<body bgcolor="#292a30">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Model Client.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pygame, random, socket, threading, json, math</span>
<span class="s0">from </span><span class="s1">game_classes </span><span class="s0">import </span><span class="s1">SCREEN_SIZE, obstacleList, npcList, enemyList, bullets, characters, explosions, Wall, \</span>
    <span class="s1">Character, Bullet, World, Enemy, nodeSetup, TILE_SIZE, Pistol, Shotgun, NeoGun, NeoShotgun</span>
<span class="s0">from </span><span class="s1">game_classes </span><span class="s0">import </span><span class="s1">WHITE, BLACK</span>
<span class="s0">from </span><span class="s1">npcs </span><span class="s0">import </span><span class="s1">Monarch</span>

<span class="s1">HOST = </span><span class="s2">'127.0.0.1'</span>
<span class="s1">PORT = </span><span class="s3">50000</span>
<span class="s1">obstacles = []</span>
<span class="s1">textMap = []</span>

<span class="s1">Waiting = </span><span class="s0">True</span>

<span class="s2">''' 
Name: recv_from_server 
Parameters: conn:connection 
Returns: None 
Purpose: Recieves messages from the server and responds as appropriate. 
'''</span>

<span class="s0">def </span><span class="s1">recv_from_server(conn):</span>
    <span class="s0">global </span><span class="s1">Waiting</span>
    <span class="s0">while True</span><span class="s1">:</span>
        <span class="s1">data = conn.recv(</span><span class="s3">1024</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">data:</span>

            <span class="s1">packet = data.decode()</span>
            <span class="s1">packet = packet.split(</span><span class="s2">&quot;#&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]</span>
            <span class="s1">print(packet)</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">packet = json.loads(packet)</span>

            <span class="s0">except</span><span class="s1">:</span><span class="s4">#continue prevents the code from trying to continue analysing this packet</span>
                <span class="s0">continue</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;START&quot;</span><span class="s1">:</span>
                <span class="s1">Waiting = </span><span class="s0">False</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;SETUP&quot;</span><span class="s1">:</span>
                <span class="s1">c = Character(int(packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;PlayerX&quot;</span><span class="s1">]), int(packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;PlayerY&quot;</span><span class="s1">]), conn, </span><span class="s0">False</span><span class="s1">, packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;id&quot;</span><span class="s1">])</span>
                <span class="s1">characters.add(c)</span>
                <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;id&quot;</span><span class="s1">] == </span><span class="s3">1</span><span class="s1">:</span>
                    <span class="s1">otherId = </span><span class="s3">0</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s1">otherId = </span><span class="s3">1</span>
                <span class="s1">playerTwo = Character(int(packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;EnemyX&quot;</span><span class="s1">]), int(packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;EnemyY&quot;</span><span class="s1">]), </span><span class="s0">None</span><span class="s1">, </span><span class="s0">False</span><span class="s1">, otherId)</span>
                <span class="s1">characters.add(playerTwo)</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;MAP&quot;</span><span class="s1">:</span>
                <span class="s1">textMap.append(packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;List&quot;</span><span class="s1">])</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;OBSTACLES&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">ob </span><span class="s0">in </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">]:</span>
                    <span class="s1">obstacles.append(ob)</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;NPCS&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">]:</span>
                    <span class="s1">npcList.add(Monarch(*i))</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;TALK&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">npc </span><span class="s0">in </span><span class="s1">npcList:</span>
                    <span class="s0">if </span><span class="s1">npc.id == packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;id&quot;</span><span class="s1">]:</span>
                        <span class="s1">player.talking = npc</span>
                        <span class="s1">player.hud.startAnimation(</span><span class="s2">&quot;open&quot;</span><span class="s1">, player.talking)</span>
                        <span class="s1">npc.addCustomer(player.id)</span>
                        <span class="s0">if not </span><span class="s1">npc.firstChat:</span>
                            <span class="s1">npc.firstChat = </span><span class="s0">True</span>


            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;ENEMIES&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">]:</span>
                    <span class="s1">enemyList.add(Enemy(*i))</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;MOVE&quot;</span><span class="s1">:</span>
                <span class="s1">playerTwo.mapX = packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;xPos&quot;</span><span class="s1">]</span>
                <span class="s1">playerTwo.mapY = packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;yPos&quot;</span><span class="s1">]</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;WEAPONSWAP&quot;</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;weapon&quot;</span><span class="s1">] == </span><span class="s2">&quot;Pistol&quot;</span><span class="s1">:</span>
                    <span class="s1">playerTwo.activeWeapon = Pistol(playerTwo)</span>
                <span class="s0">elif </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;weapon&quot;</span><span class="s1">] == </span><span class="s2">&quot;Shotgun&quot;</span><span class="s1">:</span>
                    <span class="s1">playerTwo.activeWeapon = Shotgun(playerTwo)</span>
                <span class="s0">elif </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;weapon&quot;</span><span class="s1">] == </span><span class="s2">&quot;NeoGun&quot;</span><span class="s1">:</span>
                    <span class="s1">playerTwo.activeWeapon = NeoGun(playerTwo)</span>
                <span class="s0">elif </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;weapon&quot;</span><span class="s1">] == </span><span class="s2">&quot;NeoShotgun&quot;</span><span class="s1">:</span>
                    <span class="s1">playerTwo.activeWeapon = NeoShotgun(playerTwo)</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;PROJECTILE&quot;</span><span class="s1">:</span>
                <span class="s1">playerTwo.fire((packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;start&quot;</span><span class="s1">], packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;bulletList&quot;</span><span class="s1">], packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;angle&quot;</span><span class="s1">]))</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;ENEMYDAMAGE&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">enemy </span><span class="s0">in </span><span class="s1">enemyList:</span>
                    <span class="s0">if </span><span class="s1">enemy.id == packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;id&quot;</span><span class="s1">]:</span>
                        <span class="s1">enemy.takeDamage(packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;amount&quot;</span><span class="s1">])</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;EXPLOSIONDAMAGE&quot;</span><span class="s1">:</span>
                <span class="s1">player.takeDamage(packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">])</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;DIE&quot;</span><span class="s1">:</span>
                <span class="s0">if </span><span class="s1">player.id == packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">]:</span>
                    <span class="s1">player.tell_server(</span><span class="s2">&quot;death&quot;</span><span class="s1">)</span>
                    <span class="s1">player.die()</span>
                <span class="s0">else</span><span class="s1">:</span>
                    <span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">characters:</span>
                        <span class="s0">if </span><span class="s1">p.id == packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">]:</span>
                            <span class="s1">p.deadSprite()</span>
                            <span class="s1">p.dead = </span><span class="s0">True</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;REVIVAL&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">characters:</span>
                    <span class="s0">if </span><span class="s1">p.id </span><span class="s0">in </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">][</span><span class="s2">&quot;idList&quot;</span><span class="s1">]:</span>
                        <span class="s1">p.reviveSelf()</span>
                        <span class="s0">if </span><span class="s1">p == player:</span>
                            <span class="s1">player.tell_server(</span><span class="s2">&quot;revived&quot;</span><span class="s1">)</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;NPCACTIONS&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">command </span><span class="s0">in </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">]:</span>
                    <span class="s0">for </span><span class="s1">npc </span><span class="s0">in </span><span class="s1">npcList:</span>
                        <span class="s0">if </span><span class="s1">npc.id == command[</span><span class="s2">&quot;id&quot;</span><span class="s1">]:</span>
                            <span class="s1">npc.mapX = command[</span><span class="s2">&quot;x&quot;</span><span class="s1">]</span>
                            <span class="s1">npc.mapY = command[</span><span class="s2">&quot;y&quot;</span><span class="s1">]</span>

            <span class="s0">if </span><span class="s1">packet[</span><span class="s2">&quot;command&quot;</span><span class="s1">] == </span><span class="s2">&quot;ENEMYACTIONS&quot;</span><span class="s1">:</span>
                <span class="s0">for </span><span class="s1">command </span><span class="s0">in </span><span class="s1">packet[</span><span class="s2">&quot;data&quot;</span><span class="s1">]:</span>
                    <span class="s0">for </span><span class="s1">enemy </span><span class="s0">in </span><span class="s1">enemyList:</span>
                        <span class="s0">if </span><span class="s1">enemy.id == command[</span><span class="s2">&quot;id&quot;</span><span class="s1">]:</span>
                            <span class="s0">if not </span><span class="s1">enemy.startTime:</span>
                                <span class="s0">if </span><span class="s1">command[</span><span class="s2">&quot;action&quot;</span><span class="s1">] == </span><span class="s2">&quot;MOVE&quot;</span><span class="s1">:</span>
                                    <span class="s1">enemy.mapX, enemy.mapY = command[</span><span class="s2">&quot;x&quot;</span><span class="s1">], command[</span><span class="s2">&quot;y&quot;</span><span class="s1">]</span>

                                <span class="s0">elif </span><span class="s1">command[</span><span class="s2">&quot;action&quot;</span><span class="s1">] == </span><span class="s2">&quot;ATTACK&quot;</span><span class="s1">:</span>
                                    <span class="s1">enemy.startTime = pygame.time.get_ticks()</span>

                                <span class="s0">elif </span><span class="s1">command[</span><span class="s2">&quot;action&quot;</span><span class="s1">] == </span><span class="s2">&quot;DIE&quot;</span><span class="s1">:</span>
                                    <span class="s1">enemy.attack()</span>
                                    <span class="s1">player.tell_server(</span><span class="s2">&quot;kill&quot;</span><span class="s1">, command[</span><span class="s2">&quot;id&quot;</span><span class="s1">])</span>


<span class="s1">s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span>
<span class="s1">s.connect((HOST,PORT))</span>
<span class="s1">threading.Thread(target=recv_from_server, args=(s,)).start()</span>

<span class="s1">pygame.display.init()</span>
<span class="s1">pygame.font.init()</span>
<span class="s1">SCREEN = pygame.display.set_mode(SCREEN_SIZE)</span>
<span class="s1">clock = pygame.time.Clock()</span>

<span class="s2">''' 
Name: wait_screen 
Parameters: None 
Returns: None 
Purpose: Will display a waiting screen until it has recieved a mesage to stop from the server. 
'''</span>
<span class="s0">def </span><span class="s1">wait_screen():</span>
    <span class="s0">global </span><span class="s1">Waiting</span>
    <span class="s1">text = </span><span class="s2">&quot;Waiting for the other player to connect&quot;</span>
    <span class="s1">f = pygame.font.SysFont(</span><span class="s2">&quot;Arial&quot;</span><span class="s1">,</span><span class="s3">24</span><span class="s1">)</span>
    <span class="s1">output = f.render(text,</span><span class="s0">True</span><span class="s1">, BLACK)</span>
    <span class="s1">running = </span><span class="s0">True</span>
    <span class="s0">while </span><span class="s1">Waiting:</span>
        <span class="s1">SCREEN.fill(WHITE)</span>
        <span class="s0">for </span><span class="s1">event </span><span class="s0">in </span><span class="s1">pygame.event.get():</span>
            <span class="s0">if </span><span class="s1">event.type == pygame.QUIT:</span>
                <span class="s1">running = </span><span class="s0">False</span>
                <span class="s1">Waiting = </span><span class="s0">False</span>
        <span class="s1">SCREEN.blit(output,(</span><span class="s3">200</span><span class="s1">,</span><span class="s3">400</span><span class="s1">))</span>
        <span class="s1">pygame.display.update()</span>
    <span class="s0">return </span><span class="s1">running</span>

<span class="s4"># textMap = [['DWater', 'Plains', 'Plains', 'Plains', 'Water', 'DWater', 'Plains', 'Plains', 'Forest', 'Forest', 'Forest', 'Plains', 'Forest', 'Forest', 'Plains', 'Forest', 'Forest', 'Plains', 'Forest', 'Mountain'], ['Forest', 'Water', 'Forest', 'Plains', 'Plains', 'Plains', 'Water', 'Water', 'Water', 'Forest', 'Water', 'Plains', 'Plains', 'Forest', 'Plains', 'Forest', 'Plains', 'Plains', 'Forest', 'Forest'], ['Forest', 'Plains', 'Forest', 'Water', 'Plains', 'Forest', 'Plains', 'Forest', 'Forest', 'Plains', 'Plains', 'Mountain', 'Plains', 'Plains', 'Plains', 'Forest', 'Plains', 'Forest', 'Plains', 'Forest'], ['Forest', 'Plains', 'Water', 'Forest', 'Plains', 'Plains', 'Plains', 'Forest', 'Forest', 'Forest', 'Forest', 'Plains', 'Plains', 'Plains', 'Plains', 'Forest', 'Forest', 'Plains', 'Forest', 'Mountain'], ['Forest', 'Plains', 'Plains', 'Plains', 'Forest', 'Forest', 'Forest', 'Plains', 'Forest', 'Mountain', 'Plains', 'Plains', 'Plains', 'Plains', 'Water', 'Plains', 'Forest', 'HMountain', 'Plains', 'Forest'], ['Forest', 'Plains', 'Forest', 'Forest', 'Water', 'Forest', 'Plains', 'Plains', 'Plains', 'Plains', 'Plains', 'Plains', 'Plains', 'Water', 'Forest', 'Forest', 'HMountain', 'Forest', 'Mountain', 'HMountain'], ['Forest', 'Mountain', 'Forest', 'Plains', 'Plains', 'Plains', 'Forest', 'Mountain', 'Water', 'Plains', 'Forest', 'Forest', 'Plains', 'Mountain', 'Forest', 'Forest', 'Forest', 'Mountain', 'Forest', 'Forest'], ['Plains', 'Plains', 'Water', 'Forest', 'Mountain', 'Plains', 'Plains', 'Plains', 'Water', 'Forest', 'DWater', 'Forest', 'DWater', 'Mountain', 'Plains', 'Mountain', 'Mountain', 'Forest', 'Forest', 'Forest'], ['Mountain', 'Forest', 'Forest', 'Plains', 'Plains', 'Plains', 'Forest', 'Mountain', 'Forest', 'Water', 'Water', 'Mountain', 'Mountain', 'Forest', 'HMountain', 'Mountain', 'Mountain', 'Plains', 'Plains', 'Forest'], ['Water', 'Forest', 'Forest', 'Plains', 'Plains', 'Forest', 'Mountain', 'Water', 'Plains', 'DWater', 'DWater', 'Mountain', 'Water', 'Mountain', 'Forest', 'Forest', 'Forest', 'Plains', 'Forest', 'Mountain'], ['Plains', 'Plains', 'Plains', 'Plains', 'Plains', 'Plains', 'Forest', 'Water', 'Mountain', 'HMountain', 'HMountain', 'Mountain', 'Water', 'Forest', 'Plains', 'Plains', 'Forest', 'Mountain', 'Forest', 'Forest'], ['Forest', 'Forest', 'Mountain', 'Forest', 'Plains', 'Water', 'Forest', 'Water', 'Mountain', 'Forest', 'Water', 'DWater', 'Water', 'Mountain', 'HMountain', 'HMountain', 'Mountain', 'Mountain', 'Mountain', 'Forest'], ['Plains', 'Plains', 'Plains', 'Water', 'Forest', 'Forest', 'Forest', 'Forest', 'HMountain', 'HMountain', 'Mountain', 'Mountain', 'Water', 'Forest', 'Mountain', 'Plains', 'Mountain', 'Mountain', 'Mountain', 'Mountain'], ['Plains', 'Plains', 'Plains', 'Forest', 'Plains', 'Plains', 'Water', 'Plains', 'Forest', 'Mountain', 'DWater', 'DWater', 'HMountain', 'Mountain', 'Forest', 'Forest', 'Forest', 'Forest', 'Plains', 'Plains'], ['Plains', 'Plains', 'Plains', 'Water', 'Plains', 'Plains', 'Mountain', 'Forest', 'Plains', 'Plains', 'Water', 'Forest', 'Mountain', 'Mountain', 'DWater', 'Plains', 'Forest', 'Forest', 'Forest', 'Forest'], ['Plains', 'Forest', 'Forest', 'Plains', 'Plains', 'Plains', 'Forest', 'Forest', 'Water', 'Mountain', 'Plains', 'Forest', 'Plains', 'Mountain', 'Plains', 'Plains', 'Mountain', 'Forest', 'Forest', 'Plains'], ['Forest', 'Forest', 'Plains', 'Forest', 'Plains', 'Forest', 'Forest', 'Forest', 'Forest', 'Forest', 'Plains', 'Mountain', 'Plains', 'Plains', 'Forest', 'Forest', 'Forest', 'Plains', 'Forest', 'Plains'], ['Plains', 'Mountain', 'Forest', 'Plains', 'Plains', 'Plains', 'Mountain', 'Plains', 'Mountain', 'Forest', 'Forest', 'Forest', 'Mountain', 'Forest', 'Plains', 'Water', 'Forest', 'Mountain', 'Forest', 'Plains'], ['Plains', 'Plains', 'Plains', 'Forest', 'Mountain', 'Mountain', 'Forest', 'Forest', 'Forest', 'Forest', 'Forest', 'Plains', 'Plains', 'Forest', 'Forest', 'Water', 'Plains', 'Plains', 'Forest', 'Plains'], ['Plains', 'Forest', 'Forest', 'Forest', 'Forest', 'Plains', 'Plains', 'Forest', 'Plains', 'Plains', 'Forest', 'Forest', 'Mountain', 'Forest', 'Plains', 'Forest', 'Plains', 'Water', 'Forest', 'Mountain']]</span>

<span class="s4"># y = 0</span>
<span class="s4"># for row in MAP:</span>
<span class="s4">#     x = 0</span>
<span class="s4">#     for cell in row:</span>
<span class="s4">#         if cell == &quot;1&quot;:</span>
<span class="s4">#             w = Wall((x*TILE_SIZE)+TILE_SIZE//2,(y*TILE_SIZE)+TILE_SIZE//2)</span>
<span class="s4">#             obstacleList.add(w)</span>
<span class="s4">#         x += 1</span>
<span class="s4">#     y+=1</span>

<span class="s1">running = wait_screen()</span>

<span class="s1">world = World(textMap, obstacles)</span>
<span class="s1">world.nodes = nodeSetup(world.obstacleList, world.nodes)</span>
<span class="s1">count = </span><span class="s3">0</span>


<span class="s4"># for count in range(10):</span>
<span class="s4">#   ranY = random.randint(0,len(world.nodes)-1)</span>
<span class="s4">#   ranX = random.randint(0,len(world.nodes[0])-1)</span>
<span class="s4">#   while not world.nodes[ranY][ranX]:</span>
<span class="s4">#       ranY = random.randint(0,len(world.nodes)-1)</span>
<span class="s4">#       ranX = random.randint(0,len(world.nodes[0])-1)</span>
<span class="s4">#</span>
<span class="s4">#   print(world.nodes[ranY][ranX].neighbours)</span>
	<span class="s4"># print(world.nodes[19][5].neighbours, &quot;\n&quot;, world.nodes[19][5].topLeft, world.nodes[19][5].up,</span>
	<span class="s4">#     world.nodes[19][5].topRight,</span>
	<span class="s4">#     world.nodes[19][5].right, world.nodes[19][5].bottomRight, world.nodes[19][5].down,</span>
	<span class="s4">#     world.nodes[19][5].bottomLeft, world.nodes[19][5].left)</span>

<span class="s1">player = characters.sprites()[</span><span class="s3">0</span><span class="s1">]</span>
<span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">characters:</span>
    <span class="s1">p.inventory.append(Shotgun(p))</span>
    <span class="s1">p.inventory.append(Pistol(p))</span>
    <span class="s1">p.inventory.append(NeoGun(p))</span>
    <span class="s1">p.inventory.append(NeoShotgun(p))</span>
    <span class="s1">p.activeWeapon = p.inventory[</span><span class="s3">0</span><span class="s1">]</span>

<span class="s1">packet = {</span><span class="s2">&quot;command&quot;</span><span class="s1">:</span><span class="s2">&quot;STARTCONFIRMATION&quot;</span><span class="s1">}</span>
<span class="s1">s.send((json.dumps(packet) + </span><span class="s2">&quot;#&quot;</span><span class="s1">).encode())</span>
<span class="s0">while </span><span class="s1">running == </span><span class="s0">True</span><span class="s1">:</span>
    <span class="s1">print(player.mapX, player.mapY)</span>
    <span class="s1">SCREEN.fill(WHITE)</span>
    <span class="s0">for </span><span class="s1">event </span><span class="s0">in </span><span class="s1">pygame.event.get():</span>
        <span class="s0">if </span><span class="s1">event.type == pygame.QUIT:</span>
            <span class="s1">running = </span><span class="s0">False</span>
            <span class="s1">pygame.quit()</span>
        <span class="s0">if </span><span class="s1">event.type == pygame.KEYDOWN:</span>
            <span class="s1">keys = pygame.key.get_pressed()</span>
        <span class="s0">if </span><span class="s1">event.type == pygame.MOUSEBUTTONUP:</span>
            <span class="s0">if not </span><span class="s1">pygame.mouse.get_pressed()[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">and </span><span class="s1">event.button == </span><span class="s3">1 </span><span class="s0">and not </span><span class="s1">player.talking </span><span class="s0">and not </span><span class="s1">player.dead </span><span class="s0">and not </span><span class="s1">player.paused:</span>
                <span class="s1">player.fire()</span>

    <span class="s0">for </span><span class="s1">bullet </span><span class="s0">in </span><span class="s1">bullets:</span>
        <span class="s1">data = bullet.update(enemyList, world.obstacleList)</span>
        <span class="s0">if </span><span class="s1">data:</span>
            <span class="s1">player.tell_server(</span><span class="s2">&quot;hit&quot;</span><span class="s1">, data)</span>
    <span class="s1">explosions.update()</span>
    <span class="s1">player.move(world.obstacleList)</span>
    <span class="s1">player.camera.worldAdjust(SCREEN, world, characters, enemyList, npcList)</span>
    <span class="s1">player.camera.reAdjust()</span>
    <span class="s1">player.camera.bulletAdjust(bullets, explosions)</span>
    <span class="s1">player.camera.obstacleAdjust(world.obstacleList)</span>
    <span class="s1">player.checkRevive(characters)</span>
    <span class="s1">player.checkPause()</span>
    <span class="s1">player.hud.animate()</span>
    <span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">characters:</span>
        <span class="s0">if </span><span class="s1">p == player:</span>
            <span class="s1">player.activeWeapon.calcGunAngle()</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">p.activeWeapon.calcGunAngle(</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s4"># if player.hud.animation:</span>
    <span class="s4">#     if player.hud.animation == &quot;open&quot;:</span>
    <span class="s4">#         player.hud.animateTalk()</span>
    <span class="s4">#     elif player.hud.animation == &quot;close&quot;:</span>
    <span class="s4">#         player.hud.animateExit()</span>
    <span class="s4"># else:</span>
    <span class="s4">#     if player.talking:</span>
    <span class="s4">#         player.hud.disText()</span>
    <span class="s0">for </span><span class="s1">enemy </span><span class="s0">in </span><span class="s1">enemyList:</span>
        <span class="s4"># If enough time has passed</span>
        <span class="s0">if </span><span class="s1">pygame.time.get_ticks() - enemy.startTime &gt;= </span><span class="s3">200 </span><span class="s0">and </span><span class="s1">enemy.startTime:</span>
            <span class="s1">enemy.attack()</span>

    <span class="s1">world.draw(SCREEN)</span>
    <span class="s1">explosions.draw(SCREEN)</span>
    <span class="s1">npcList.draw(SCREEN)</span>
    <span class="s1">characters.draw(SCREEN)</span>
    <span class="s1">world.obstacleList.draw(SCREEN)</span>
    <span class="s1">bullets.draw(SCREEN)</span>
    <span class="s1">enemyList.draw(SCREEN)</span>
    <span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">characters:</span>
        <span class="s1">p.activeWeapon.draw(SCREEN)</span>
    <span class="s1">player.hud.draw(SCREEN)</span>
    <span class="s1">clock.tick(</span><span class="s3">60</span><span class="s1">)</span>
    <span class="s1">pygame.display.update()</span></pre>
</body>
</html>